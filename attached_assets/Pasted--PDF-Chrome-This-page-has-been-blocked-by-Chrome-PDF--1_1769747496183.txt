# ğŸ”§ PDF ë·°ì–´ Chrome ì°¨ë‹¨ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

> **ë¬¸ì œ:** "This page has been blocked by Chrome" ì—ëŸ¬ë¡œ PDFê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ  
> **í™˜ê²½:** Replit í˜¸ìŠ¤íŒ… ì›¹ì•±

---

## ğŸ“‹ ëª©ì°¨

1. [ë¬¸ì œ ì›ì¸ ë¶„ì„](#1-ë¬¸ì œ-ì›ì¸-ë¶„ì„)
2. [í•´ê²° ë°©ë²• 1: react-pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© (ê¶Œì¥)](#2-í•´ê²°-ë°©ë²•-1-react-pdf-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì‚¬ìš©-ê¶Œì¥)
3. [í•´ê²° ë°©ë²• 2: PDF.js ì§ì ‘ êµ¬í˜„](#3-í•´ê²°-ë°©ë²•-2-pdfjs-ì§ì ‘-êµ¬í˜„)
4. [í•´ê²° ë°©ë²• 3: Google Docs Viewer ì‚¬ìš©](#4-í•´ê²°-ë°©ë²•-3-google-docs-viewer-ì‚¬ìš©)
5. [íŒŒì¼ ì—…ë¡œë“œ ë° ì €ì¥ ì„¤ì •](#5-íŒŒì¼-ì—…ë¡œë“œ-ë°-ì €ì¥-ì„¤ì •)
6. [CORS ë° ë³´ì•ˆ í—¤ë” ì„¤ì •](#6-cors-ë°-ë³´ì•ˆ-í—¤ë”-ì„¤ì •)
7. [ì „ì²´ ì½”ë“œ ì˜ˆì‹œ](#7-ì „ì²´-ì½”ë“œ-ì˜ˆì‹œ)
8. [ë¬¸ì œ í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸](#8-ë¬¸ì œ-í•´ê²°-ì²´í¬ë¦¬ìŠ¤íŠ¸)

---

## 1. ë¬¸ì œ ì›ì¸ ë¶„ì„

### 1.1 "This page has been blocked by Chrome" ë°œìƒ ì›ì¸

| ì›ì¸ | ì„¤ëª… | í•´ê²° ë°©í–¥ |
|------|------|----------|
| **iframe ì§ì ‘ ë¡œë“œ** | Chromeì´ ì™¸ë¶€ PDFë¥¼ iframeì—ì„œ ì§ì ‘ ë¡œë“œí•˜ëŠ” ê²ƒì„ ì°¨ë‹¨ | PDF.js ë˜ëŠ” react-pdf ì‚¬ìš© |
| **CORS ì •ì±…** | PDF íŒŒì¼ ì„œë²„ì—ì„œ CORS í—¤ë”ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ | ì„œë²„ì— CORS í—¤ë” ì¶”ê°€ |
| **Mixed Content** | HTTPS í˜ì´ì§€ì—ì„œ HTTP PDF ë¡œë“œ ì‹œë„ | ëª¨ë“  URLì„ HTTPSë¡œ í†µì¼ |
| **X-Frame-Options** | PDF í˜¸ìŠ¤íŒ… ì„œë²„ê°€ iframe ì„ë² ë”© ì°¨ë‹¨ | ìì²´ ì„œë²„ì—ì„œ PDF ì œê³µ ë˜ëŠ” PDF.js ì‚¬ìš© |

### 1.2 í˜„ì¬ ì½”ë“œ ë¬¸ì œì  (ì¶”ì •)

```jsx
// âŒ ë¬¸ì œê°€ ë˜ëŠ” ì½”ë“œ (iframe ì§ì ‘ ì‚¬ìš©)
const PDFViewer = ({ url }) => {
  return (
    <iframe 
      src={url}  // ì™¸ë¶€ URL ì§ì ‘ ë¡œë“œ ì‹œ Chrome ì°¨ë‹¨
      width="100%" 
      height="600px"
    />
  );
};
```

---

## 2. í•´ê²° ë°©ë²• 1: react-pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© (ê¶Œì¥)

### 2.1 íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
npm install react-pdf
# ë˜ëŠ”
yarn add react-pdf
```

### 2.2 PDF ë·°ì–´ ì»´í¬ë„ŒíŠ¸ ìƒì„±

**íŒŒì¼ ìœ„ì¹˜:** `client/src/components/PDFViewer.jsx`

```jsx
import React, { useState, useRef, useEffect } from 'react';
import { Document, Page, pdfjs } from 'react-pdf';

// âš ï¸ ì¤‘ìš”: PDF.js ì›Œì»¤ ì„¤ì • (ë°˜ë“œì‹œ í•„ìš”)
pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.js`;

// CSS ì„í¬íŠ¸ (í…ìŠ¤íŠ¸ ì„ íƒ ë° ì£¼ì„ ë ˆì´ì–´ìš©)
import 'react-pdf/dist/esm/Page/AnnotationLayer.css';
import 'react-pdf/dist/esm/Page/TextLayer.css';

const PDFViewer = ({ 
  fileUrl,        // PDF íŒŒì¼ URL
  fileName,       // íŒŒì¼ëª… (ë‹¤ìš´ë¡œë“œìš©)
  title,          // í‘œì‹œ ì œëª©
  department,     // ë¶€ì„œ ì •ë³´
  hashtags = [],  // í•´ì‹œíƒœê·¸ ë°°ì—´
  onClose         // ë‹«ê¸° ì½œë°±
}) => {
  // ìƒíƒœ ê´€ë¦¬
  const [numPages, setNumPages] = useState(null);
  const [pageNumber, setPageNumber] = useState(1);
  const [scale, setScale] = useState(1.0);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  const containerRef = useRef(null);

  // ì»¨í…Œì´ë„ˆ ë„ˆë¹„ì— ë§ê²Œ ìŠ¤ì¼€ì¼ ìë™ ì¡°ì •
  useEffect(() => {
    const updateScale = () => {
      if (containerRef.current) {
        const containerWidth = containerRef.current.clientWidth;
        // A4 ê¸°ì¤€ ë„ˆë¹„ 612pt, íŒ¨ë”© 32px ì œì™¸
        const optimalScale = (containerWidth - 32) / 612;
        setScale(Math.min(optimalScale, 1.5)); // ìµœëŒ€ 1.5ë°°
      }
    };

    updateScale();
    window.addEventListener('resize', updateScale);
    return () => window.removeEventListener('resize', updateScale);
  }, []);

  // PDF ë¡œë“œ ì„±ê³µ
  const onDocumentLoadSuccess = ({ numPages }) => {
    setNumPages(numPages);
    setLoading(false);
    setError(null);
  };

  // PDF ë¡œë“œ ì‹¤íŒ¨
  const onDocumentLoadError = (error) => {
    console.error('PDF ë¡œë“œ ì˜¤ë¥˜:', error);
    setLoading(false);
    setError('PDF íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
  };

  // í˜ì´ì§€ ì´ë™
  const goToPrevPage = () => setPageNumber(prev => Math.max(prev - 1, 1));
  const goToNextPage = () => setPageNumber(prev => Math.min(prev + 1, numPages || 1));

  // í™•ëŒ€/ì¶•ì†Œ
  const zoomIn = () => setScale(prev => Math.min(prev + 0.25, 3));
  const zoomOut = () => setScale(prev => Math.max(prev - 0.25, 0.5));

  // PDF ë‹¤ìš´ë¡œë“œ
  const handleDownload = async () => {
    try {
      const response = await fetch(fileUrl);
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = fileName || 'manual.pdf';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      window.URL.revokeObjectURL(url);
    } catch (err) {
      console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', err);
      // í´ë°±: ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
      window.open(fileUrl, '_blank');
    }
  };

  // ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ (ëª¨ë°”ì¼)
  const [touchStart, setTouchStart] = useState(null);
  
  const handleTouchStart = (e) => {
    setTouchStart(e.touches[0].clientX);
  };
  
  const handleTouchEnd = (e) => {
    if (!touchStart) return;
    const touchEnd = e.changedTouches[0].clientX;
    const diff = touchStart - touchEnd;
    
    if (Math.abs(diff) > 50) {
      diff > 0 ? goToNextPage() : goToPrevPage();
    }
    setTouchStart(null);
  };

  return (
    <div className="fixed inset-0 bg-white z-50 flex flex-col">
      {/* í—¤ë” */}
      <header className="flex items-center justify-between px-4 py-3 border-b bg-white shadow-sm">
        <button 
          onClick={onClose}
          className="p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors"
          aria-label="ë‹«ê¸°"
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
        
        <div className="flex-1 text-center px-4">
          <h1 className="font-semibold text-gray-900 truncate">{title}</h1>
          <div className="flex items-center justify-center gap-2 mt-1">
            {department && (
              <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">
                {department}
              </span>
            )}
            {hashtags.slice(0, 3).map((tag, i) => (
              <span key={i} className="text-xs text-gray-500">#{tag}</span>
            ))}
          </div>
        </div>
        
        <button 
          onClick={handleDownload}
          className="p-2 -mr-2 hover:bg-gray-100 rounded-full transition-colors"
          aria-label="ë‹¤ìš´ë¡œë“œ"
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
        </button>
      </header>

      {/* PDF ë·°ì–´ ì˜ì—­ */}
      <div 
        ref={containerRef}
        className="flex-1 overflow-auto bg-gray-100"
        onTouchStart={handleTouchStart}
        onTouchEnd={handleTouchEnd}
      >
        {/* ë¡œë”© ìƒíƒœ */}
        {loading && (
          <div className="flex flex-col items-center justify-center h-full">
            <div className="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mb-4" />
            <p className="text-gray-500">PDFë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
        )}

        {/* ì—ëŸ¬ ìƒíƒœ */}
        {error && (
          <div className="flex flex-col items-center justify-center h-full p-8 text-center">
            <svg className="w-16 h-16 text-red-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <p className="text-gray-600 mb-4">{error}</p>
            <button 
              onClick={() => window.location.reload()}
              className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
            >
              ë‹¤ì‹œ ì‹œë„
            </button>
          </div>
        )}

        {/* PDF ë¬¸ì„œ */}
        <Document
          file={fileUrl}
          onLoadSuccess={onDocumentLoadSuccess}
          onLoadError={onDocumentLoadError}
          loading={null}
          className="flex flex-col items-center py-4"
          options={{
            cMapUrl: `//unpkg.com/pdfjs-dist@${pdfjs.version}/cmaps/`,
            cMapPacked: true,
          }}
        >
          <Page 
            pageNumber={pageNumber}
            scale={scale}
            className="shadow-lg bg-white"
            renderTextLayer={true}
            renderAnnotationLayer={true}
            loading={
              <div className="w-full h-96 bg-gray-200 animate-pulse rounded" />
            }
          />
        </Document>
      </div>

      {/* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ë°” */}
      <footer className="flex items-center justify-between px-4 py-3 border-t bg-white safe-area-bottom">
        {/* í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ */}
        <div className="flex items-center gap-1">
          <button 
            onClick={goToPrevPage}
            disabled={pageNumber <= 1}
            className="p-2 hover:bg-gray-100 rounded-full disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
            aria-label="ì´ì „ í˜ì´ì§€"
          >
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          
          <span className="text-sm text-gray-600 min-w-[70px] text-center font-medium">
            {pageNumber} / {numPages || '-'}
          </span>
          
          <button 
            onClick={goToNextPage}
            disabled={pageNumber >= numPages}
            className="p-2 hover:bg-gray-100 rounded-full disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
            aria-label="ë‹¤ìŒ í˜ì´ì§€"
          >
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>

        {/* í™•ëŒ€/ì¶•ì†Œ */}
        <div className="flex items-center gap-1">
          <button 
            onClick={zoomOut}
            disabled={scale <= 0.5}
            className="p-2 hover:bg-gray-100 rounded-full disabled:opacity-30 transition-colors"
            aria-label="ì¶•ì†Œ"
          >
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7" />
            </svg>
          </button>
          
          <span className="text-sm text-gray-600 min-w-[50px] text-center">
            {Math.round(scale * 100)}%
          </span>
          
          <button 
            onClick={zoomIn}
            disabled={scale >= 3}
            className="p-2 hover:bg-gray-100 rounded-full disabled:opacity-30 transition-colors"
            aria-label="í™•ëŒ€"
          >
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7" />
            </svg>
          </button>
        </div>
      </footer>
    </div>
  );
};

export default PDFViewer;
```

### 2.3 CSS ì¶”ê°€ (ì„ íƒì‚¬í•­)

**íŒŒì¼ ìœ„ì¹˜:** `client/src/styles/pdf-viewer.css`

```css
/* PDF ë·°ì–´ ìŠ¤íƒ€ì¼ */
.react-pdf__Document {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.react-pdf__Page {
  margin-bottom: 16px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.react-pdf__Page canvas {
  max-width: 100%;
  height: auto !important;
}

/* í…ìŠ¤íŠ¸ ë ˆì´ì–´ (ì„ íƒ ê°€ëŠ¥í•˜ê²Œ) */
.react-pdf__Page__textContent {
  user-select: text;
}

/* ì£¼ì„ ë ˆì´ì–´ (ë§í¬ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ) */
.react-pdf__Page__annotations {
  pointer-events: auto;
}

/* iOS Safe Area */
.safe-area-bottom {
  padding-bottom: max(12px, env(safe-area-inset-bottom));
}

/* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.animate-spin {
  animation: spin 1s linear infinite;
}
```

### 2.4 ì‚¬ìš© ì˜ˆì‹œ

```jsx
// ManualLibrary.jsx ë˜ëŠ” í•´ë‹¹ í˜ì´ì§€ì—ì„œ
import PDFViewer from './components/PDFViewer';

const ManualLibrary = () => {
  const [selectedManual, setSelectedManual] = useState(null);
  const [showPDFViewer, setShowPDFViewer] = useState(false);

  const handleManualClick = (manual) => {
    setSelectedManual(manual);
    setShowPDFViewer(true);
  };

  const handleClosePDF = () => {
    setShowPDFViewer(false);
    setSelectedManual(null);
  };

  return (
    <div>
      {/* ë§¤ë‰´ì–¼ ëª©ë¡ */}
      {manuals.map(manual => (
        <div 
          key={manual.id}
          onClick={() => handleManualClick(manual)}
          className="cursor-pointer"
        >
          {manual.title}
        </div>
      ))}

      {/* PDF ë·°ì–´ ëª¨ë‹¬ */}
      {showPDFViewer && selectedManual && (
        <PDFViewer
          fileUrl={selectedManual.fileUrl}
          fileName={selectedManual.fileName}
          title={selectedManual.title}
          department={selectedManual.department?.name}
          hashtags={selectedManual.hashtags}
          onClose={handleClosePDF}
        />
      )}
    </div>
  );
};
```

---

## 3. í•´ê²° ë°©ë²• 2: PDF.js ì§ì ‘ êµ¬í˜„

react-pdfê°€ ì‘ë™í•˜ì§€ ì•Šì„ ê²½ìš° PDF.jsë¥¼ ì§ì ‘ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 3.1 HTMLì— PDF.js CDN ì¶”ê°€

**íŒŒì¼ ìœ„ì¹˜:** `client/index.html`

```html
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C&W Korea ì˜¨ë³´ë”©</title>
  
  <!-- PDF.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  </script>
</head>
<body>
  <div id="root"></div>
</body>
</html>
```

### 3.2 Canvas ê¸°ë°˜ PDF ë·°ì–´

```jsx
// components/PDFViewerCanvas.jsx
import React, { useEffect, useRef, useState } from 'react';

const PDFViewerCanvas = ({ fileUrl, title, onClose }) => {
  const canvasRef = useRef(null);
  const [pdfDoc, setPdfDoc] = useState(null);
  const [pageNum, setPageNum] = useState(1);
  const [totalPages, setTotalPages] = useState(0);
  const [scale, setScale] = useState(1.5);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // PDF ë¡œë“œ
  useEffect(() => {
    const loadPDF = async () => {
      try {
        setLoading(true);
        setError(null);
        
        // PDF.jsë¡œ ë¬¸ì„œ ë¡œë“œ
        const loadingTask = window.pdfjsLib.getDocument(fileUrl);
        const pdf = await loadingTask.promise;
        
        setPdfDoc(pdf);
        setTotalPages(pdf.numPages);
        setLoading(false);
      } catch (err) {
        console.error('PDF ë¡œë“œ ì˜¤ë¥˜:', err);
        setError('PDFë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        setLoading(false);
      }
    };

    loadPDF();
  }, [fileUrl]);

  // í˜ì´ì§€ ë Œë”ë§
  useEffect(() => {
    const renderPage = async () => {
      if (!pdfDoc || !canvasRef.current) return;

      try {
        const page = await pdfDoc.getPage(pageNum);
        const viewport = page.getViewport({ scale });
        
        const canvas = canvasRef.current;
        const context = canvas.getContext('2d');
        
        // Canvas í¬ê¸° ì„¤ì •
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        // í˜ì´ì§€ ë Œë”ë§
        await page.render({
          canvasContext: context,
          viewport: viewport
        }).promise;
      } catch (err) {
        console.error('í˜ì´ì§€ ë Œë”ë§ ì˜¤ë¥˜:', err);
      }
    };

    renderPage();
  }, [pdfDoc, pageNum, scale]);

  const goToPrev = () => setPageNum(prev => Math.max(prev - 1, 1));
  const goToNext = () => setPageNum(prev => Math.min(prev + 1, totalPages));

  return (
    <div className="fixed inset-0 bg-white z-50 flex flex-col">
      {/* í—¤ë” */}
      <header className="flex items-center justify-between px-4 py-3 border-b">
        <button onClick={onClose} className="p-2">
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
        <h1 className="font-semibold truncate flex-1 text-center px-4">{title}</h1>
        <div className="w-10" />
      </header>

      {/* PDF ìº”ë²„ìŠ¤ ì˜ì—­ */}
      <div className="flex-1 overflow-auto bg-gray-100 flex justify-center p-4">
        {loading && (
          <div className="flex items-center justify-center h-full">
            <div className="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent" />
          </div>
        )}
        
        {error && (
          <div className="flex items-center justify-center h-full text-red-500">
            {error}
          </div>
        )}
        
        <canvas 
          ref={canvasRef} 
          className="shadow-lg bg-white"
          style={{ display: loading ? 'none' : 'block' }}
        />
      </div>

      {/* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */}
      <footer className="flex items-center justify-center gap-4 px-4 py-3 border-t">
        <button 
          onClick={goToPrev} 
          disabled={pageNum <= 1}
          className="p-2 disabled:opacity-30"
        >
          ì´ì „
        </button>
        <span>{pageNum} / {totalPages}</span>
        <button 
          onClick={goToNext} 
          disabled={pageNum >= totalPages}
          className="p-2 disabled:opacity-30"
        >
          ë‹¤ìŒ
        </button>
      </footer>
    </div>
  );
};

export default PDFViewerCanvas;
```

---

## 4. í•´ê²° ë°©ë²• 3: Google Docs Viewer ì‚¬ìš©

ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì´ì§€ë§Œ ì œí•œì´ ìˆìŠµë‹ˆë‹¤.

### 4.1 ì¥ë‹¨ì 

| ì¥ì  | ë‹¨ì  |
|------|------|
| êµ¬í˜„ì´ ë§¤ìš° ê°„ë‹¨ | íŒŒì¼ì´ ê³µê°œ ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ í•¨ |
| ë³„ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆí•„ìš” | 25MB íŒŒì¼ í¬ê¸° ì œí•œ |
| ëŒ€ë¶€ë¶„ì˜ PDF ì§€ì› | Google ì„œë²„ ì˜ì¡´ |

### 4.2 êµ¬í˜„

```jsx
// âš ï¸ íŒŒì¼ URLì´ ê³µê°œì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ í•¨
const GoogleDocsViewer = ({ fileUrl, title, onClose }) => {
  // URL ì¸ì½”ë”©
  const encodedUrl = encodeURIComponent(fileUrl);
  const viewerUrl = `https://docs.google.com/viewer?url=${encodedUrl}&embedded=true`;

  return (
    <div className="fixed inset-0 bg-white z-50 flex flex-col">
      <header className="flex items-center justify-between px-4 py-3 border-b">
        <button onClick={onClose} className="p-2">ë‹«ê¸°</button>
        <h1 className="font-semibold">{title}</h1>
        <a href={fileUrl} download className="p-2">ë‹¤ìš´ë¡œë“œ</a>
      </header>
      
      <iframe
        src={viewerUrl}
        className="flex-1 w-full border-none"
        title={title}
      />
    </div>
  );
};
```

---

## 5. íŒŒì¼ ì—…ë¡œë“œ ë° ì €ì¥ ì„¤ì •

### 5.1 ì„œë²„ ì‚¬ì´ë“œ: íŒŒì¼ ì—…ë¡œë“œ API

**íŒŒì¼ ìœ„ì¹˜:** `server/routes/upload.js`

```javascript
const express = require('express');
const multer = require('multer');
const path = require('path');
const { v4: uuidv4 } = require('uuid');
const fs = require('fs');

const router = express.Router();

// ì—…ë¡œë“œ í´ë” ìƒì„±
const uploadDir = path.join(__dirname, '../uploads/manuals');
if (!fs.existsSync(uploadDir)) {
  fs.mkdirSync(uploadDir, { recursive: true });
}

// Multer ì„¤ì •
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, uploadDir);
  },
  filename: (req, file, cb) => {
    // ê³ ìœ  íŒŒì¼ëª… ìƒì„±
    const uniqueName = `${uuidv4()}${path.extname(file.originalname)}`;
    cb(null, uniqueName);
  }
});

const upload = multer({
  storage,
  limits: {
    fileSize: 10 * 1024 * 1024, // 10MB
  },
  fileFilter: (req, file, cb) => {
    if (file.mimetype === 'application/pdf') {
      cb(null, true);
    } else {
      cb(new Error('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'), false);
    }
  }
});

// íŒŒì¼ ì—…ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸
router.post('/upload', upload.single('file'), (req, res) => {
  try {
    if (!req.file) {
      return res.status(400).json({ error: 'íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.' });
    }

    // íŒŒì¼ URL ìƒì„± (Replit í™˜ê²½)
    const fileUrl = `/api/files/${req.file.filename}`;
    
    res.json({
      success: true,
      fileUrl,
      fileName: req.file.originalname,
      fileSize: req.file.size
    });
  } catch (error) {
    console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
    res.status(500).json({ error: 'ì—…ë¡œë“œ ì‹¤íŒ¨' });
  }
});

// íŒŒì¼ ì œê³µ ì—”ë“œí¬ì¸íŠ¸ (ì¤‘ìš”!)
router.get('/files/:filename', (req, res) => {
  const filePath = path.join(uploadDir, req.params.filename);
  
  // íŒŒì¼ ì¡´ì¬ í™•ì¸
  if (!fs.existsSync(filePath)) {
    return res.status(404).json({ error: 'íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' });
  }

  // âš ï¸ ì¤‘ìš”: CORS ë° Content-Type í—¤ë” ì„¤ì •
  res.setHeader('Content-Type', 'application/pdf');
  res.setHeader('Content-Disposition', 'inline');
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('X-Content-Type-Options', 'nosniff');
  
  // íŒŒì¼ ìŠ¤íŠ¸ë¦¼ ì „ì†¡
  const fileStream = fs.createReadStream(filePath);
  fileStream.pipe(res);
});

module.exports = router;
```

### 5.2 ì„œë²„ ë©”ì¸ íŒŒì¼ì— ë¼ìš°íŠ¸ ì¶”ê°€

**íŒŒì¼ ìœ„ì¹˜:** `server/index.js`

```javascript
const express = require('express');
const cors = require('cors');
const uploadRoutes = require('./routes/upload');

const app = express();

// CORS ì„¤ì • (ì¤‘ìš”!)
app.use(cors({
  origin: '*', // ë˜ëŠ” íŠ¹ì • ë„ë©”ì¸
  methods: ['GET', 'POST', 'PUT', 'DELETE'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));

app.use(express.json());

// ì •ì  íŒŒì¼ ì œê³µ (ì—…ë¡œë“œëœ íŒŒì¼)
app.use('/uploads', express.static('uploads'));

// API ë¼ìš°íŠ¸
app.use('/api', uploadRoutes);

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
```

---

## 6. CORS ë° ë³´ì•ˆ í—¤ë” ì„¤ì •

### 6.1 Express ë¯¸ë“¤ì›¨ì–´ ì„¤ì •

```javascript
// server/middleware/headers.js
const setSecurityHeaders = (req, res, next) => {
  // CORS í—ˆìš©
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  
  // PDF iframe ì„ë² ë”© í—ˆìš©
  res.setHeader('X-Frame-Options', 'SAMEORIGIN');
  
  // Content Security Policy
  res.setHeader(
    'Content-Security-Policy',
    "default-src 'self'; " +
    "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://unpkg.com; " +
    "style-src 'self' 'unsafe-inline'; " +
    "img-src 'self' data: blob:; " +
    "frame-src 'self' blob:; " +
    "worker-src 'self' blob: https://unpkg.com https://cdnjs.cloudflare.com;"
  );
  
  next();
};

module.exports = setSecurityHeaders;
```

### 6.2 Replit í™˜ê²½ ì„¤ì •

**.replit íŒŒì¼ (ì´ë¯¸ ì¡´ì¬í•  ê²½ìš° ìˆ˜ì •)**

```toml
run = "npm start"

[env]
NODE_ENV = "production"

[[ports]]
localPort = 3000
externalPort = 80
```

---

## 7. ì „ì²´ ì½”ë“œ ì˜ˆì‹œ

### 7.1 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
project/
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ PDFViewer.jsx        # PDF ë·°ì–´ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ ManualCard.jsx       # ë§¤ë‰´ì–¼ ì¹´ë“œ
â”‚   â”‚   â”‚   â””â”€â”€ ManualLibrary.jsx    # ë§¤ë‰´ì–¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”‚   â””â”€â”€ pdf-viewer.css
â”‚   â”‚   â””â”€â”€ App.jsx
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ upload.js
â”‚   â”‚   â””â”€â”€ manuals.js
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ headers.js
â”‚   â”œâ”€â”€ uploads/
â”‚   â”‚   â””â”€â”€ manuals/                 # PDF íŒŒì¼ ì €ì¥ í´ë”
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ package.json
â””â”€â”€ .replit
```

### 7.2 package.json ì˜ì¡´ì„±

```json
{
  "name": "onboarding-system",
  "version": "1.0.0",
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-pdf": "^7.7.0",
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "multer": "^1.4.5-lts.1",
    "uuid": "^9.0.0"
  }
}
```

### 7.3 ì„¤ì¹˜ ë° ì‹¤í–‰

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev
```

---

## 8. ë¬¸ì œ í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸

### 8.1 ë””ë²„ê¹… ìˆœì„œ

```
â–¡ Step 1: ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ ì—ëŸ¬ í™•ì¸
â–¡ Step 2: Network íƒ­ì—ì„œ PDF íŒŒì¼ ìš”ì²­ ìƒíƒœ í™•ì¸
â–¡ Step 3: PDF URLì´ ì ‘ê·¼ ê°€ëŠ¥í•œì§€ ì§ì ‘ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ë³´ê¸°
â–¡ Step 4: CORS í—¤ë”ê°€ ì œëŒ€ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
â–¡ Step 5: PDF.js ì›Œì»¤ê°€ ë¡œë“œë˜ëŠ”ì§€ í™•ì¸
```

### 8.2 ì¼ë°˜ì ì¸ ì˜¤ë¥˜ ë° í•´ê²°

| ì˜¤ë¥˜ | ì›ì¸ | í•´ê²° |
|------|------|------|
| `Failed to load PDF` | PDF URL ì ‘ê·¼ ë¶ˆê°€ | ì„œë²„ì—ì„œ íŒŒì¼ ì œê³µ í™•ì¸ |
| `CORS error` | CORS í—¤ë” ì—†ìŒ | ì„œë²„ì— CORS ì„¤ì • ì¶”ê°€ |
| `Worker error` | PDF.js ì›Œì»¤ ë¡œë“œ ì‹¤íŒ¨ | CDN URL í™•ì¸ |
| `Blocked by Chrome` | iframe ì§ì ‘ ë¡œë“œ | react-pdf ë˜ëŠ” PDF.js ì‚¬ìš© |
| `Mixed content` | HTTP/HTTPS í˜¼í•© | ëª¨ë“  URL HTTPSë¡œ ë³€ê²½ |

### 8.3 í…ŒìŠ¤íŠ¸ ë°©ë²•

```javascript
// PDF URL ì ‘ê·¼ í…ŒìŠ¤íŠ¸
const testPDFAccess = async (url) => {
  try {
    const response = await fetch(url, { method: 'HEAD' });
    console.log('Status:', response.status);
    console.log('Content-Type:', response.headers.get('content-type'));
    console.log('CORS:', response.headers.get('access-control-allow-origin'));
    return response.ok;
  } catch (error) {
    console.error('PDF ì ‘ê·¼ ì˜¤ë¥˜:', error);
    return false;
  }
};

// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‹¤í–‰
testPDFAccess('YOUR_PDF_URL_HERE');
```

### 8.4 ìµœì¢… í™•ì¸ ì‚¬í•­

- [ ] `npm install react-pdf` ì™„ë£Œ
- [ ] PDF.js ì›Œì»¤ URL ì„¤ì • ì™„ë£Œ
- [ ] ì„œë²„ì—ì„œ PDF íŒŒì¼ ì œê³µ ì—”ë“œí¬ì¸íŠ¸ ìƒì„±
- [ ] CORS í—¤ë” ì„¤ì • ì™„ë£Œ
- [ ] PDF ë·°ì–´ ì»´í¬ë„ŒíŠ¸ import ë° ì‚¬ìš©
- [ ] ëª¨ë°”ì¼ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

## ğŸ“ ì¶”ê°€ ì§€ì›

ì´ ê°€ì´ë“œë¡œë„ í•´ê²°ë˜ì§€ ì•ŠëŠ” ê²½ìš°:

1. ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬ ë©”ì‹œì§€ ìº¡ì²˜
2. Network íƒ­ì˜ PDF ìš”ì²­ ì •ë³´ ìº¡ì²˜
3. ì„œë²„ ë¡œê·¸ í™•ì¸

ìœ„ ì •ë³´ì™€ í•¨ê»˜ ë¬¸ì˜í•´ì£¼ì‹œë©´ ì¶”ê°€ ì§€ì› ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

> **ë¬¸ì„œ ë²„ì „:** 1.0  
> **ìµœì¢… ìˆ˜ì •:** 2025-01-30  
> **ì‘ì„±:** Claude AI